I"WI<p>A new Oce user wondered how to get Spanish labels on axes.  This is easy for some plot types because <code class="highlighter-rouge">xlab</code> and <code class="highlighter-rouge">ylab</code> arguments are obeyed, but in many cases the labels are generated by the code.  That meant that it was finally time for me to start localizing Oce, using the <a href="http://www.gnu.org/software/gettext/">GNU gettext</a> scheme.  Gettext being unfamiliar to me, I stumbled a bit at first, and decided to document the procedure here.</p>

<p>The start of this blog post is mostly for me, while the end is mostly for users who would like to help in the translation effort.</p>

<h1 id="part-1-developer-notes">PART 1: developer notes</h1>

<h2 id="initial-work-cycle">Initial work cycle</h2>

<h3 id="step-1">Step 1</h3>

<p>Create a directory named <code class="highlighter-rouge">oce/po/</code>.</p>

<h3 id="step-2">Step 2</h3>

<p>The basic procedure it to change a code fragment like</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="n">ylab</span><span class="o">=</span><span class="s2">"Depth"</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>which is clearly not appropriate in all languages, into</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="n">gettext</span><span class="p">(</span><span class="s2">"Depth"</span><span class="p">,</span><span class="w"> </span><span class="n">domain</span><span class="o">=</span><span class="s2">"R-oce"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>which yields an entry in a translation table that can then be tailored for any desired language.  (The <code class="highlighter-rouge">gettext()</code> call should not really need to set the <code class="highlighter-rouge">domain</code>, but I found it necessary for some items, and decided to include it everywhere.)</p>

<h3 id="step-3">Step 3</h3>

<p>Enter the <code class="highlighter-rouge">oce</code> directory, launch R, and type as follows, to insert a file named <code class="highlighter-rouge">R-oce.pot</code> in the <code class="highlighter-rouge">po</code> directory.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="n">tools</span><span class="o">::</span><span class="n">update_pkg_po</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>This create a file that has entries for all errors, warnings, and messages, as well as for <code class="highlighter-rouge">gettext()</code> entries.  The file will be named <code class="highlighter-rouge">po/R-oce.pot</code>, and will contain entry pairs such as the following.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre>msgid <span class="s2">"Depth"</span>
msgstr <span class="s2">""</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The first of these is a key, and the second is a replacement string (discussed presently).  The details of the file format, and much else relating to <code class="highlighter-rouge">gettext</code> are available at the <a href="http://www.gnu.org/software/gettext/manual/gettext.html">GNU site</a>.</p>

<h3 id="step-4">Step 4</h3>

<p>To start work on, say, a French translation table, type the following in the shell.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="nb">cd </span>oce/po
msginit <span class="nt">--locale</span><span class="o">=</span>R-fr <span class="nt">--input</span> R-oce.pot
</pre></td></tr></tbody></table></code></pre></figure>

<p>This creates an English-French translation table in a file named <code class="highlighter-rouge">po/R-fr.po</code>.  This must be done just once for each language to be translated.  The key is the <code class="highlighter-rouge">fr</code> part of the name, which is the <a href="http://en.wikipedia.org/wiki/ISO_639">ISO-639</a> code for French.</p>

<p>Once the file is created, look at it with a text editor and, if necessary, change the <code class="highlighter-rouge">charset</code> to <code class="highlighter-rouge">UTF-8</code>, which can handle most languages.</p>

<p>Importantly, running <code class="highlighter-rouge">msginit</code> is only necessary at the first stage of translation.  As new entries are added, one must only follow the work cycle given below.</p>

<h3 id="step-5">Step 5</h3>

<p>Edit <code class="highlighter-rouge">po/R-fr.po</code> as desired, inserting translations.  You will need a text editor that permits characters in a variety of languages; vim and emacs are ideal for this.</p>

<p>Simply change the <code class="highlighter-rouge">msgstr</code> item to the translated value, e.g. for French the <code class="highlighter-rouge">R-fr.po</code> file should contain</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre>msgid <span class="s2">"Depth"</span>
msgstr <span class="s2">"Profondeur"</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>for this entry.</p>

<h2 id="update-work-cycle">Update work cycle</h2>

<p>The work cycle is as follows.</p>

<ol>
  <li>
    <p>Edit the R source code, replacing strings like <code class="highlighter-rouge">FOO</code> with <code class="highlighter-rouge">gettext("FOO", "R-oce")</code>.</p>
  </li>
  <li>
    <p>Launch R in the <code class="highlighter-rouge">oce</code> directory and invoke <code class="highlighter-rouge">tools::update_pkg_po(".")</code> to add an entry to the <code class="highlighter-rouge">po/R-oce.pot</code> file, with corresponding entries in <code class="highlighter-rouge">po/R-fr.po</code> and any other existing translation files.</p>
  </li>
  <li>
    <p>Edit <code class="highlighter-rouge">po/R-fr.po</code> and any other translation files, changing the <code class="highlighter-rouge">msgstr</code> entry that corresponds to <code class="highlighter-rouge">FOO</code>.</p>
  </li>
  <li>
    <p>Run <code class="highlighter-rouge">tools::update_pkg_po(".")</code> again, to update all relevant files in the <code class="highlighter-rouge">inst</code> directory.</p>
  </li>
  <li>
    <p>Build and test oce.</p>
  </li>
  <li>
    <p>Repeat from step 1 as required for other words.</p>
  </li>
</ol>

<p>Since step 5 is slow, it helps to be watching your country win a gold medal in the Olympics hockey game, while you are doing such work.</p>

<h2 id="using-translations">Using translations</h2>

<p>In most cases the system language will be set with system tools.  Still, <code class="highlighter-rouge">Sys.setenv()</code> can be handy for switching the language used in a plot (e.g. a French user may have the computer set up to work in French, but may prefer to graph data using English, for publication).  Commonly, <code class="highlighter-rouge">Sys.setenv()</code> will be done in the R startup file, or defined in the OS shell, e.g. below for a temporary use</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nv">LANG</span><span class="o">=</span>es_ES.UTF-8 R <span class="nt">--no-save</span> &lt; spanish.R
</pre></td></tr></tbody></table></code></pre></figure>

<h1 id="part-2-helping-me-with-the-translation-effort">PART 2: Helping me with the translation effort</h1>

<p>At the moment, Oce works in English, with some support for Spanish, French and German.  The support for Mandarin is crude, having come from online translation engines.</p>

<p>If you would like Oce graphs to work in another language with which you have high familiarity, please contact me.  I will need you to write down a few relevant words in your language and send them to me via PDF or scanned hand-written document (MSword and OpenOffice formats cannot are not useful).  Minimally, the words should be the ones used on axes of the graphs you use, but it would help other users if you could translate the phrases listed below.  Also, translate <code class="highlighter-rouge">E</code>, <code class="highlighter-rouge">W</code>, <code class="highlighter-rouge">N</code>, and <code class="highlighter-rouge">S</code>, as used in longitude and latitude, as well as any other unit abbreviations that differ between English and your language.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>Absolute Salinity
Conservative Temperature
Depth
Distance
Elevation
Longitude
Latitude
Potential Temperature
Potential Density Anomaly
Practical Salinity
Pressure
Sea Level
Speed
Temperature
Velocity
</pre></td></tr></tbody></table></code></pre></figure>

<p>The easiest way to provide translated items is in a UTF-8 file containing translated phrases that I can copy and paste into the source files.</p>

<h2 id="table-of-results">Table of results</h2>

<p>The following code demonstrates translations by default plots for various data types.  Mandarin requires a font-family specification.  The Mandarin translations came from online engines and may be laughably bad.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="n">library</span><span class="p">(</span><span class="n">oce</span><span class="p">)</span><span class="w">
</span><span class="n">datasets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"adv"</span><span class="p">,</span><span class="s2">"adp"</span><span class="p">,</span><span class="s2">"argo"</span><span class="p">,</span><span class="s2">"cm"</span><span class="p">,</span><span class="s2">"ctd"</span><span class="p">,</span><span class="s2">"lisst"</span><span class="p">,</span><span class="s2">"lobo"</span><span class="p">,</span><span class="s2">"sealevel"</span><span class="p">,</span><span class="s2">"section"</span><span class="p">)</span><span class="w">
</span><span class="n">languages</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"en"</span><span class="p">,</span><span class="s2">"es"</span><span class="p">,</span><span class="s2">"de"</span><span class="p">,</span><span class="s2">"fr"</span><span class="p">,</span><span class="s2">"zh"</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">datasets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">data</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="n">d</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"section"</span><span class="p">)</span><span class="w">
        </span><span class="n">section</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sectionGrid</span><span class="p">(</span><span class="n">section</span><span class="p">)</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">languages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">pdf</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s2">"-"</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="s2">".pdf"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="s2">"zh"</span><span class="p">)</span><span class="w"> </span><span class="s2">"GB1"</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">"Helvetica"</span><span class="p">)</span><span class="w">
        </span><span class="n">Sys.setenv</span><span class="p">(</span><span class="n">LANGUAGE</span><span class="o">=</span><span class="n">l</span><span class="p">)</span><span class="w">
        </span><span class="n">plot</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w">
        </span><span class="n">dev.off</span><span class="p">()</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The results of the test code given above are shown below (click to enlarge).</p>

<h3 id="english">English</h3>

<p><a href="/assets/adp-en.png"><img src="/assets/adp-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/adv-en.png"><img src="/assets/adv-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/argo-en.png"><img src="/assets/argo-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/cm-en.png"><img src="/assets/cm-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/ctd-en.png"><img src="/assets/ctd-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/lisst-en.png"><img src="/assets/lisst-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/lobo-en.png"><img src="/assets/lobo-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/sealevel-en.png"><img src="/assets/sealevel-en-thumbnail.png" alt="tg" /></a>
<a href="/assets/section-en.png"><img src="/assets/section-en-thumbnail.png" alt="tg" /></a></p>

<h3 id="french">French</h3>

<p><a href="/assets/adp-fr.png"><img src="/assets/adp-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/adv-fr.png"><img src="/assets/adv-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/argo-fr.png"><img src="/assets/argo-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/cm-fr.png"><img src="/assets/cm-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/ctd-fr.png"><img src="/assets/ctd-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/lisst-fr.png"><img src="/assets/lisst-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/lobo-fr.png"><img src="/assets/lobo-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/sealevel-fr.png"><img src="/assets/sealevel-fr-thumbnail.png" alt="tg" /></a>
<a href="/assets/section-fr.png"><img src="/assets/section-fr-thumbnail.png" alt="tg" /></a></p>

<h3 id="german">German</h3>

<p><a href="/assets/adp-de.png"><img src="/assets/adp-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/adv-de.png"><img src="/assets/adv-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/argo-de.png"><img src="/assets/argo-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/cm-de.png"><img src="/assets/cm-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/ctd-de.png"><img src="/assets/ctd-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/lisst-de.png"><img src="/assets/lisst-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/lobo-de.png"><img src="/assets/lobo-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/sealevel-de.png"><img src="/assets/sealevel-de-thumbnail.png" alt="tg" /></a>
<a href="/assets/section-de.png"><img src="/assets/section-de-thumbnail.png" alt="tg" /></a></p>

<h3 id="spanish">Spanish</h3>

<p><a href="/assets/adp-fr.png"><img src="/assets/adp-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/adv-fr.png"><img src="/assets/adv-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/argo-fr.png"><img src="/assets/argo-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/cm-fr.png"><img src="/assets/cm-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/ctd-fr.png"><img src="/assets/ctd-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/lisst-fr.png"><img src="/assets/lisst-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/lobo-fr.png"><img src="/assets/lobo-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/sealevel-fr.png"><img src="/assets/sealevel-es-thumbnail.png" alt="tg" /></a>
<a href="/assets/section-fr.png"><img src="/assets/section-es-thumbnail.png" alt="tg" /></a></p>

<h3 id="mandarin">Mandarin</h3>

<p><a href="/assets/adp-zh.png"><img src="/assets/adp-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/adv-zh.png"><img src="/assets/adv-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/argo-zh.png"><img src="/assets/argo-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/cm-zh.png"><img src="/assets/cm-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/ctd-zh.png"><img src="/assets/ctd-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/lisst-zh.png"><img src="/assets/lisst-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/lobo-zh.png"><img src="/assets/lobo-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/sealevel-zh.png"><img src="/assets/sealevel-zh-thumbnail.png" alt="tg" /></a>
<a href="/assets/section-zh.png"><img src="/assets/section-zh-thumbnail.png" alt="tg" /></a></p>

<h2 id="resources">Resources</h2>

<ul>
  <li>
    <p><a href="http://developer.r-project.org/Translations30.html">R documentation on translation methodology</a></p>
  </li>
  <li>
    <p><a href="http://www.gnu.org/software/gettext/">GNU documentation on gettext</a></p>
  </li>
</ul>

:ET