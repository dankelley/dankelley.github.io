---
layout: post
title: Oce translations
tags: [R, oce, translation]
category: R
year: 2014
month: 2
day: 26
summary: The method for adding additional languages to Oce graphics is described.
description: The method for adding additional languages to Oce graphics is described.
---

A new Oce user wondered how to get Spanish labels on axes.  This is easy for some plot types because ``xlab`` and ``ylab`` arguments are obeyed, but in many cases the labels are generated by the code.  That meant that it was finally time for me to start localizing Oce, using the [GNU gettext](http://www.gnu.org/software/gettext/) scheme.  Gettext being unfamiliar to me, I stumbled a bit at first, and decided to document the procedure here.  

The start of this blog post is mostly for me, while the end is mostly for users who would like to help in the translation effort.

# PART 1: developer notes

## Initial work cycle

### Step 1

Create a directory named ``oce/po/``.

### Step 2

The basic procedure it to change a code fragment like
{% highlight R linenos=table %}
ylab="Depth"
{% endhighlight %}
which is clearly not appropriate in all languages, into
{% highlight R linenos=table %}
gettext("Depth", domain="R-oce")
{% endhighlight %}
which yields an entry in a translation table that can then be tailored for any desired language.  (The ``gettext()`` call should not really need to set the ``domain``, but I found it necessary for some items, and decided to include it everywhere.)

### Step 3

Enter the ``oce`` directory, launch R, and type as follows, to insert a file named ``R-oce.pot`` in the ``po`` directory.


{% highlight R linenos=table %}
tools::update_pkg_po(".")
{% endhighlight %}

This create a file that has entries for all errors, warnings, and messages, as well as for ``gettext()`` entries.  The file will be named ``po/R-oce.pot``, and will contain entry pairs such as the following.
{% highlight bash linenos=table %}
msgid "Depth"
msgstr ""
{% endhighlight %}
The first of these is a key, and the second is a replacement string (discussed presently).  The details of the file format, and much else relating to ``gettext`` are available at the [GNU site](http://www.gnu.org/software/gettext/manual/gettext.html).


### Step 4

To start work on, say, a French translation table, type the following in the shell.

{% highlight bash linenos=table %}
cd oce/po
msginit --locale=R-fr --input R-oce.pot
{% endhighlight %}

This creates an English-French translation table in a file named ``po/R-fr.po``.  This must be done just once for each language to be translated.  The key is the ``fr`` part of the name, which is the [ISO-639](http://en.wikipedia.org/wiki/ISO_639) code for French.  

Once the file is created, look at it with a text editor and, if necessary, change the ``charset`` to ``UTF-8``, which can handle most languages.

Importantly, running ``msginit`` is only necessary at the first stage of translation.  As new entries are added, one must only follow the work cycle given below.

### Step 5

Edit ``po/R-fr.po`` as desired, inserting translations.  You will need a text editor that permits characters in a variety of languages; vim and emacs are ideal for this.

Simply change the ``msgstr`` item to the translated value, e.g. for French the ``R-fr.po`` file should contain
{% highlight bash linenos=table %}
msgid "Depth"
msgstr "Profondeur"
{% endhighlight %}
for this entry.


## Update work cycle

The work cycle is as follows.

1. Edit the R source code, replacing strings like ``FOO`` with ``gettext("FOO", "R-oce")``.

2. Launch R in the ``oce`` directory and invoke ``tools::update_pkg_po(".")`` to add an entry to the ``po/R-oce.pot`` file, with corresponding entries in ``po/R-fr.po`` and any other existing translation files.

3. Edit ``po/R-fr.po`` and any other translation files, changing the ``msgstr`` entry that corresponds to ``FOO``.

4. Run ``tools::update_pkg_po(".")`` again, to update all relevant files in the ``inst`` directory.

5. Build and test oce.

6. Repeat from step 1 as required for other words.

Since step 5 is slow, it helps to be watching your country win a gold medal in the Olympics hockey game, while you are doing such work.

## Using translations

In most cases the system language will be set with system tools.  Still, ``Sys.setenv()`` can be handy for switching the language used in a plot (e.g. a French user may have the computer set up to work in French, but may prefer to graph data using English, for publication).  Commonly, ``Sys.setenv()`` will be done in the R startup file, or defined in the OS shell, e.g. below for a temporary use

{% highlight bash linenos=table %}
LANG=es_ES.UTF-8 R --no-save < spanish.R
{% endhighlight %}



# PART 2: Helping me with the translation effort

At the moment, Oce works in English, with some support for Spanish, French and German.  The support for Mandarin is crude, having come from online translation engines.

If you would like Oce graphs to work in another language with which you have high familiarity, please contact me.  I will need you to write down a few relevant words in your language and send them to me via PDF or scanned hand-written document (MSword and OpenOffice formats cannot are not useful).  Minimally, the words should be the ones used on axes of the graphs you use, but it would help other users if you could translate the phrases listed below.  Also, translate ``E``, ``W``, ``N``, and ``S``, as used in longitude and latitude, as well as any other unit abbreviations that differ between English and your language.

{% highlight bash linenos=table %}
Absolute Salinity
Conservative Temperature
Depth
Distance
Elevation
Longitude
Latitude
Potential Temperature
Potential Density Anomaly
Practical Salinity
Pressure
Sea Level
Speed
Temperature
Velocity
{% endhighlight %}

The easiest way to provide translated items is in a UTF-8 file containing translated phrases that I can copy and paste into the source files.


## Table of results

The following code demonstrates translations by default plots for various data types.  Mandarin requires a font-family specification.  The Mandarin translations came from online engines and may be laughably bad.

{% highlight R linenos=table %}
library(oce)
datasets <- c("adv","adp","argo","cm","ctd","lisst","lobo","sealevel","section")
languages <- c("en","es","de","fr","zh")
for (d in datasets) {
    data(list=d)
    if (d == "section")
        section <- sectionGrid(section)
    for (l in languages) {
        pdf(paste(d,"-",l,".pdf",sep=""), family=if (l=="zh") "GB1" else "Helvetica")
        Sys.setenv(LANGUAGE=l)
        plot(get(d))
        dev.off()
    }
}
{% endhighlight %}


To make the above work, an up-to-date version of the ``translation`` branch must be installed, by executing the following in R:
{% highlight R linenos=table %}
library(devtools)
install_github("ocedata", "dankelley", "master")
install_github("oce", "dankelley", "languages")
{% endhighlight %}

The results of the test code given above are shown below (click to enlarge).


### English

[![tg]({{ site.url }}/assets/adp-en-thumbnail.png)]({{ site.url }}/assets/adp-en.png)
[![tg]({{ site.url }}/assets/adv-en-thumbnail.png)]({{ site.url }}/assets/adv-en.png)
[![tg]({{ site.url }}/assets/argo-en-thumbnail.png)]({{ site.url }}/assets/argo-en.png)
[![tg]({{ site.url }}/assets/cm-en-thumbnail.png)]({{ site.url }}/assets/cm-en.png)
[![tg]({{ site.url }}/assets/ctd-en-thumbnail.png)]({{ site.url }}/assets/ctd-en.png)
[![tg]({{ site.url }}/assets/lisst-en-thumbnail.png)]({{ site.url }}/assets/lisst-en.png)
[![tg]({{ site.url }}/assets/lobo-en-thumbnail.png)]({{ site.url }}/assets/lobo-en.png)
[![tg]({{ site.url }}/assets/sealevel-en-thumbnail.png)]({{ site.url }}/assets/sealevel-en.png)
[![tg]({{ site.url }}/assets/section-en-thumbnail.png)]({{ site.url }}/assets/section-en.png)

### Spanish

[![tg]({{ site.url }}/assets/adp-es-thumbnail.png)]({{ site.url }}/assets/adp-fr.png)
[![tg]({{ site.url }}/assets/adv-es-thumbnail.png)]({{ site.url }}/assets/adv-fr.png)
[![tg]({{ site.url }}/assets/argo-es-thumbnail.png)]({{ site.url }}/assets/argo-fr.png)
[![tg]({{ site.url }}/assets/cm-es-thumbnail.png)]({{ site.url }}/assets/cm-fr.png)
[![tg]({{ site.url }}/assets/ctd-es-thumbnail.png)]({{ site.url }}/assets/ctd-fr.png)
[![tg]({{ site.url }}/assets/lisst-es-thumbnail.png)]({{ site.url }}/assets/lisst-fr.png)
[![tg]({{ site.url }}/assets/lobo-es-thumbnail.png)]({{ site.url }}/assets/lobo-fr.png)
[![tg]({{ site.url }}/assets/sealevel-es-thumbnail.png)]({{ site.url }}/assets/sealevel-fr.png)
[![tg]({{ site.url }}/assets/section-es-thumbnail.png)]({{ site.url }}/assets/section-fr.png)

### French

[![tg]({{ site.url }}/assets/adp-fr-thumbnail.png)]({{ site.url }}/assets/adp-fr.png)
[![tg]({{ site.url }}/assets/adv-fr-thumbnail.png)]({{ site.url }}/assets/adv-fr.png)
[![tg]({{ site.url }}/assets/argo-fr-thumbnail.png)]({{ site.url }}/assets/argo-fr.png)
[![tg]({{ site.url }}/assets/cm-fr-thumbnail.png)]({{ site.url }}/assets/cm-fr.png)
[![tg]({{ site.url }}/assets/ctd-fr-thumbnail.png)]({{ site.url }}/assets/ctd-fr.png)
[![tg]({{ site.url }}/assets/lisst-fr-thumbnail.png)]({{ site.url }}/assets/lisst-fr.png)
[![tg]({{ site.url }}/assets/lobo-fr-thumbnail.png)]({{ site.url }}/assets/lobo-fr.png)
[![tg]({{ site.url }}/assets/sealevel-fr-thumbnail.png)]({{ site.url }}/assets/sealevel-fr.png)
[![tg]({{ site.url }}/assets/section-fr-thumbnail.png)]({{ site.url }}/assets/section-fr.png)

### German

[![tg]({{ site.url }}/assets/adp-de-thumbnail.png)]({{ site.url }}/assets/adp-de.png)
[![tg]({{ site.url }}/assets/adv-de-thumbnail.png)]({{ site.url }}/assets/adv-de.png)
[![tg]({{ site.url }}/assets/argo-de-thumbnail.png)]({{ site.url }}/assets/argo-de.png)
[![tg]({{ site.url }}/assets/cm-de-thumbnail.png)]({{ site.url }}/assets/cm-de.png)
[![tg]({{ site.url }}/assets/ctd-de-thumbnail.png)]({{ site.url }}/assets/ctd-de.png)
[![tg]({{ site.url }}/assets/lisst-de-thumbnail.png)]({{ site.url }}/assets/lisst-de.png)
[![tg]({{ site.url }}/assets/lobo-de-thumbnail.png)]({{ site.url }}/assets/lobo-de.png)
[![tg]({{ site.url }}/assets/sealevel-de-thumbnail.png)]({{ site.url }}/assets/sealevel-de.png)
[![tg]({{ site.url }}/assets/section-de-thumbnail.png)]({{ site.url }}/assets/section-de.png)

### Mandarin

[![tg]({{ site.url }}/assets/adp-zh-thumbnail.png)]({{ site.url }}/assets/adp-zh.png)
[![tg]({{ site.url }}/assets/adv-zh-thumbnail.png)]({{ site.url }}/assets/adv-zh.png)
[![tg]({{ site.url }}/assets/argo-zh-thumbnail.png)]({{ site.url }}/assets/argo-zh.png)
[![tg]({{ site.url }}/assets/cm-zh-thumbnail.png)]({{ site.url }}/assets/cm-zh.png)
[![tg]({{ site.url }}/assets/ctd-zh-thumbnail.png)]({{ site.url }}/assets/ctd-zh.png)
[![tg]({{ site.url }}/assets/lisst-zh-thumbnail.png)]({{ site.url }}/assets/lisst-zh.png)
[![tg]({{ site.url }}/assets/lobo-zh-thumbnail.png)]({{ site.url }}/assets/lobo-zh.png)
[![tg]({{ site.url }}/assets/sealevel-zh-thumbnail.png)]({{ site.url }}/assets/sealevel-zh.png)
[![tg]({{ site.url }}/assets/section-zh-thumbnail.png)]({{ site.url }}/assets/section-zh.png)



## Resources

* [R documentation on translation methodology](http://developer.r-project.org/Translations30.html)

* [GNU documentation on gettext](http://www.gnu.org/software/gettext/)


